<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LêUai - Catálogo</title>
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="stylesheet" href="../styles/styles.css">
    <style>
        /* Estilos especificos do Catalogo */
        .content-wrapper {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .novidades-section {
            display: flex;
            gap: 3rem;
            align-items: flex-start;
            margin-bottom: 3rem;
        }

        .titulo-novidades {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--gray-900);
            min-width: 200px;
            text-align: right;
            padding-top: 1rem;
        }

        .catalogo-novidades {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            flex: 1;
        }

        .book-card-novidade {
            background: var(--white);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
        }

        .book-card-novidade:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .capa-novidade-container {
            width: 100%;
            height: 180px;
            position: relative;
            overflow: hidden;
        }

        .capa-novidade-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .capa-novidade-tag {
            position: absolute;
            top: 0.5rem;
            left: 0.5rem;
        }

        .book-info-novidade {
            padding: 1rem;
        }

        .book-info-novidade h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .book-info-novidade p {
            font-size: 0.85rem;
            color: var(--gray-600);
        }

        .catalogo-geral {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }

        .book-item-geral {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
        }

        .book-item-geral:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .capa-mini-container {
            width: 60px;
            height: 80px;
            border-radius: var(--radius-sm);
            overflow: hidden;
            flex-shrink: 0;
        }

        .capa-mini-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .info-geral h3 {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .info-geral p {
            font-size: 0.8rem;
            color: var(--gray-600);
        }

        .info-geral span {
            font-size: 0.8rem;
            color: var(--gray-500);
            font-weight: 500;
        }

        .moby-dick-item {
            grid-column: 1 / -1;
        }

        @media (max-width: 768px) {
            .novidades-section {
                flex-direction: column;
            }
            .titulo-novidades {
                text-align: center;
            }
            .catalogo-novidades {
                grid-template-columns: 1fr;
            }
        }

    </style>
</head>
<body>

    <header>
        <div class="header-logo">
            <img src="../assets/logo.png" alt="LêUai">
        </div>
        <nav>
            <ul>
                <li><a href="./Home.html">Home</a></li>
                <li><a href="./catálogodelivros.html">Acervo</a></li>
                <li><a href="./favoritos.html">Salvos</a></li>
                <li><a href="./expert-reader.html">Expert Reader</a></li>
                <li>
                    <div class="search-container">
                        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.3-4.3"></path>
                        </svg>
                        <input type="text" id="searchInput" placeholder="Pesquisar">
                    </div>
                </li>
            </ul>
        </nav>
    </header>

    <section class="hero-banner">
        <h1>Catálogo de Livros</h1>
        <p>Descubra novos títulos e explore nosso acervo.</p>
        <div class="search-box">
             <button id="heroSearchButton">Buscar</button>
        </div>
        <div class="categories">
            <a href="#" data-action="filter" data-term="Todos">Todos</a>
            <a href="#" data-action="filter" data-term="Romance">Romance</a>
            <a href="#" data-action="filter" data-term="Fantasia">Fantasia</a>
            <a href="#" data-action="filter" data-term="Ficção">Ficção</a>
            <a href="#" data-action="filter" data-term="Thriller">Thriller</a>
            <a href="#" data-action="filter" data-term="Aventura">Aventura</a>
        </div>
    </section>

    <div class="content-wrapper">
        <section id="catalogo"> <h2 class="section-title">Catálogo de Livros</h2>
            <p class="section-subtitle">Explore nossa coleção de livros.</p>

            <div class="catalogo-geral" id="catalogo-container">
                <!-- Livros carregados dinamicamente -->
            </div>
        </section>
    </div>

    <footer class="footer">
        <div class="footer-links">
            <a href="#" data-action="footer" data-term="Sobre Nós">Sobre Nós</a>
            <a href="#" data-action="footer" data-term="Política de Privacidade">Política de Privacidade</a>
            <a href="#" data-action="footer" data-term="Termos de Uso">Termos de Uso</a>
            <a href="#" data-action="footer" data-term="Contacte-Nos">Contacte-Nos</a>
        </div>
    </footer>

    <!-- Scripts centralizados -->
    <script src="../scripts/dados.js"></script>
    <script src="../scripts/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Mapeamento de titulos para IDs
            const titulosParaIds = {
                'O Senhor dos Anéis': 6,
                '1984': 4,
                'A Revolução dos Bichos': 5,
                'Orgulho e Preconceito': 7,
                'Moby Dick': 8
            };

            // Navegacao
            const navLinks = document.querySelectorAll('.nav-links a');
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const term = link.getAttribute('data-term');
                    if (term === 'Home') APP.irParaHome();
                    else if (term === 'Salvos') APP.irParaFavoritos();
                    else if (term === 'Catálogo de Livros') {
                        document.getElementById('catalogo').scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });

            // Busca
            const searchInput = document.getElementById('searchInput');
            const heroSearchButton = document.getElementById('heroSearchButton');

            const realizarBusca = () => {
                const termo = searchInput.value.trim();
                if (termo) APP.realizarBusca(termo);
            };

            heroSearchButton.addEventListener('click', (e) => { e.preventDefault(); realizarBusca(); });
            searchInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') { e.preventDefault(); realizarBusca(); } });

            // Categorias - filtrar por genero
            const categories = document.querySelectorAll('.categories a');
            const catalogoContainer = document.querySelector('.catalogo-geral');

            function exibirLivrosFiltrados(livros) {
                catalogoContainer.innerHTML = '';

                if (livros.length === 0) {
                    catalogoContainer.innerHTML = '<p style="grid-column: 1/-1; text-align: center; padding: 2rem;">Nenhum livro encontrado nesta categoria.</p>';
                    return;
                }

                livros.forEach(livro => {
                    const autor = BIBLIOTECA.getAutorById(livro.autorId);
                    const bookDiv = document.createElement('div');
                    bookDiv.className = 'book-item-geral';
                    bookDiv.setAttribute('data-book-title', livro.titulo);
                    bookDiv.style.cursor = 'pointer';

                    bookDiv.innerHTML = `
                        <div class="capa-mini-container">
                            <img src="${livro.capa}" alt="Capa do livro ${livro.titulo}">
                        </div>
                        <div class="info-geral">
                            <h3>${livro.titulo}</h3>
                            <p>${livro.descricao.substring(0, 30)}...</p>
                            <span>${autor ? autor.nome : 'Desconhecido'}</span>
                        </div>
                    `;

                    bookDiv.addEventListener('click', () => APP.irParaLivro(livro.id));
                    catalogoContainer.appendChild(bookDiv);
                });
            }

            categories.forEach(cat => {
                cat.addEventListener('click', (e) => {
                    e.preventDefault();
                    const genero = cat.getAttribute('data-term');

                    // Remove active de todos e adiciona no clicado
                    categories.forEach(c => c.style.fontWeight = 'normal');
                    cat.style.fontWeight = 'bold';

                    if (genero === 'Todos') {
                        exibirLivrosFiltrados(BIBLIOTECA.livros);
                    } else {
                        const livros = BIBLIOTECA.getLivrosPorGenero(genero);
                        exibirLivrosFiltrados(livros);
                    }
                });
            });

            // Cards de livros clicaveis
            const bookElements = document.querySelectorAll('.book-item-geral');
            bookElements.forEach(bookElement => {
                bookElement.style.cursor = 'pointer';
                bookElement.addEventListener('click', (e) => {
                    e.preventDefault();
                    const bookTitle = bookElement.getAttribute('data-book-title');

                    // Buscar por titulo
                    if (titulosParaIds[bookTitle]) {
                        APP.irParaLivro(titulosParaIds[bookTitle]);
                    } else {
                        // Buscar no banco de dados
                        const livro = BIBLIOTECA.livros.find(l =>
                            l.titulo.toLowerCase().includes(bookTitle.toLowerCase())
                        );
                        if (livro) {
                            APP.irParaLivro(livro.id);
                        }
                    }
                });
            });

            // Footer
            const footerLinks = document.querySelectorAll('.footer-links a');
            footerLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const term = link.getAttribute('data-term');
                    alert(`${term}: Em breve mais informações.`);
                });
            });

            // Carregar todos os livros ao iniciar
            exibirLivrosFiltrados(BIBLIOTECA.livros);

            // Verificar se veio com filtro na URL
            const filtro = APP.getParametroURL('filtro');
            if (filtro) {
                searchInput.value = filtro;
                // Destacar resultados (opcional)
            }
        });
    </script>
</body>
</html>
